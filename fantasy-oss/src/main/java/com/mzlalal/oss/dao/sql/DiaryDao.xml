<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mzlalal.oss.dao.DiaryDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap id="diaryMap" type="com.mzlalal.base.entity.oss.dto.DiaryEntity">
        <result column="id" property="id"/>
        <result column="diary_content" property="diaryContent"/>
        <result column="diary_date" property="diaryDate"/>
        <result column="is_hide" property="isHide"/>
        <result column="create_by" property="createBy"/>
        <result column="create_name" property="createName"/>
        <result column="create_time" property="createTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="update_time" property="updateTime"/>
        <result column="update_name" property="updateName"/>
    </resultMap>

    <select id="queryRecentDate" resultType="java.util.Date">
        SELECT DISTINCT diary_date FROM t_diary
        <where>
            <if test="subscribeUserIdList != null and subscribeUserIdList.size() > 0">
                AND create_by IN
                <foreach close=" )" collection="subscribeUserIdList" index="index" item="item" open="( " separator=",">
                    #{item}
                </foreach>
            </if>
            <if test="diaryContent != null and diaryContent != ''">
                AND diary_content LIKE CONCAT('%', #{diaryContent}, '%')
            </if>
        </where>
        ORDER BY diary_date DESC
    </select>

    <select id="queryDiaryContentStatistics" parameterType="java.util.List" resultType="com.mzlalal.base.entity.oss.vo.DiaryStatVo">
        select
        td.create_by user_id,
        (select tu.username from t_user tu where tu.id = td.create_by) user_name,
        sum(length(td.diary_content)) total_word
        from t_diary td
        where td.create_by in
        <foreach close=" )" collection="subscribeUserIdList" index="index" item="item" open="( " separator=",">
            #{item}
        </foreach>
        group by td.create_by
    </select>
</mapper>