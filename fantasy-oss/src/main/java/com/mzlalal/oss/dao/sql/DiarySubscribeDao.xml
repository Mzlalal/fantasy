<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mzlalal.oss.dao.DiarySubscribeDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.mzlalal.base.entity.oss.dto.DiarySubscribeEntity" id="diarySubscribeMap">
        <result property="id" column="id"/>
        <result property="subscribeUserId" column="subscribe_user_id"/>
        <result property="subscribeStatus" column="subscribe_status"/>
        <result property="createBy" column="create_by"/>
        <result property="createName" column="create_name"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateName" column="update_name"/>
        <result property="updateTime" column="update_time"/>
        <association property="subscribeUsername" column="subscribe_user_id" javaType="string"
                     select="queryUsernameById"/>
        <association property="followerUsername" column="create_by" javaType="string"
                     select="queryUsernameById"/>
    </resultMap>

    <select id="queryUsernameById" resultType="string">
        select username from t_user where id = #{id}
    </select>

    <select id="queryApplySubscribeUsernameBySearchKeyword"
            resultType="com.mzlalal.base.entity.oss.dto.DiarySubscribeEntity">
        SELECT
        u.id AS subscribe_user_id,
        u.username AS subscribe_username,
        ds.id AS id,
        IFNULL(ds.subscribe_status, 0) AS subscribe_status
        FROM
        t_user u
        LEFT JOIN t_diary_subscribe ds ON u.id = ds.subscribe_user_id
        WHERE
        (u.username LIKE concat('%', #{searchKeyword}, '%') OR u.mobile LIKE concat('%', #{searchKeyword}, '%'))
        AND u.id NOT IN (#{currentUserId})
    </select>

</mapper>