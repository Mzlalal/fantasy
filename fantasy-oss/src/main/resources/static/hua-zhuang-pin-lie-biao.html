<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0, user-scalable=no"
          name="viewport">
    <title>åŒ–å¦†å“åˆ—è¡¨</title>
    <link href="css/plugin/frozen.css" rel="stylesheet"/>
    <link href="css/common.css" rel="stylesheet"/>
    <script src="js/plugin/axios.min.js"></script>
    <script src="js/plugin/vue.min.js"></script>
    <script src="js/CommonUtil.js"></script>
    <script src="js/FantasyConstant.js"></script>
    <script src="js/components/PopupMenu.js"></script>
    <script src="js/components/DownSlideStream.js"></script>
</head>
<style>
    /* åŒ–å¦†å“å¡ç‰‡æ ·å¼ */
    .cosmetic-card {
        background: white;
        border-radius: 8px;
        margin: 8px 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 16px;
        position: relative;
        transition: all 0.3s ease;
    }

    .cosmetic-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .cosmetic-card.top-pinned {
        border-left: 4px solid #ff6b6b;
        background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
    }

    /* åŒ–å¦†å“åç§°åŒºåŸŸ */
    .cosmetic-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .cosmetic-name {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        flex: 1;
        margin: 0;
    }

    .stock-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        text-align: center;
        min-width: 60px;
    }

    .stock-badge.high {
        background: #d4edda;
        color: #155724;
    }

    .stock-badge.medium {
        background: #fff3cd;
        color: #856404;
    }

    .stock-badge.low {
        background: #f8d7da;
        color: #721c24;
    }

    /* å¤‡æ³¨åŒºåŸŸ */
    .cosmetic-memo {
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
        line-height: 1.4;
    }

    /* æé†’ä¿¡æ¯åŒºåŸŸ */
    .cosmetic-reminder {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: #888;
    }

    .reminder-time {
        flex: 1;
    }

    .reminder-type {
        background: #f0f0f0;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
    }

    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
    }

    .empty-state i {
        font-size: 48px;
        margin-bottom: 16px;
        display: block;
    }

    /* ç½®é¡¶å›¾æ ‡ */
    .pin-icon {
        position: absolute;
        top: 12px;
        right: 12px;
        color: #ff6b6b;
        font-size: 16px;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 480px) {
        .cosmetic-card {
            margin: 6px 8px;
            padding: 12px;
        }

        .cosmetic-name {
            font-size: 15px;
        }
    }
</style>
<body>
<div id="app">
    <header class="ui-header ui-header-positive ui-border-b text-center">
        <span @click="menuShow = true" class="position-left username-display">æˆ‘çš„èœå•</span>
        <span @click="redirectSaveTodo" class="position-right username-display">æ·»åŠ åŒ–å¦†å“</span>
    </header>

    <template-down-slide-stream :distance-to-bottom="90"
                                :has-been-bottom="currPage >= totalPage"
                                :has-data="todoList && todoList.length > 0"
                                :loading="loading"
                                :offset-to-bottom="45"
                                @on-scroll-to-bottom="onScrollToBottom">
        <slot>
            <div v-if="todoList && todoList.length > 0">
                <div :class="{'top-pinned': todo.notifyTopStatus === '1'}"
                     @click="redirectUpdateTodo(todo)"
                     class="cosmetic-card"
                     v-for="todo in todoList">
                    <!-- ç½®é¡¶å›¾æ ‡ -->
                    <div class="pin-icon" v-if="todo.notifyTopStatus === '1'">ğŸ“Œ</div>

                    <!-- åŒ–å¦†å“åç§°å’Œåº“å­˜ -->
                    <div class="cosmetic-header">
                        <h4 class="cosmetic-name">{{todo.cosmeticName}}</h4>
                        <span :class="getStockBadgeClass(todo.cosmeticStock)" class="stock-badge">
                            åº“å­˜ {{todo.cosmeticStock}}
                        </span>
                    </div>

                    <!-- å¤‡æ³¨ä¿¡æ¯ -->
                    <div class="cosmetic-memo" v-if="todo.notifyMemo">
                        {{todo.notifyMemo}}
                    </div>

                    <!-- æé†’ä¿¡æ¯ -->
                    <div class="cosmetic-reminder">
                        <div class="reminder-time">
                            ğŸ“… ä¸‹æ¬¡æé†’æ—¶é—´ {{todo.notifyExecTime}}
                        </div>
                        <span class="reminder-type">{{todo.notifyType | repeatNotifyModeFilter}}</span>
                    </div>
                </div>
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div class="empty-state" v-else>
                <div>ğŸ’„</div>
                <div>æš‚æ— åŒ–å¦†å“å¾…åŠ</div>
                <div style="font-size: 14px; margin-top: 8px;">ç‚¹å‡»å³ä¸Šè§’æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªåŒ–å¦†å“æé†’å§</div>
            </div>
        </slot>
    </template-down-slide-stream>

    <template-popup-menu :menu-show="menuShow" @on-close="menuShow = false"></template-popup-menu>
</div>
</body>
<script>
    new Vue({
        el: "#app",
        data: {
            // å½“å‰é¡µ
            currPage: 1,
            // æ€»é¡µæ•°
            totalPage: 0,
            // åŠ è½½ä¸­
            loading: false,
            // èœå•æ˜¾ç¤º
            menuShow: false,
            // é»˜è®¤åˆ—è¡¨
            todoList: [],
        },
        filters: {
            repeatNotifyModeFilter(notifyType) {
                if (notifyType <= 0) {
                    return "æé†’ä¸€æ¬¡";
                }
                for (let index in window.repeatModeOption) {
                    let item = window.repeatModeOption[index];
                    if (notifyType === item.code) {
                        return item.label;
                    }
                }
            }
        },
        methods: {
            // è·å–åº“å­˜å¾½ç« æ ·å¼ç±»
            getStockBadgeClass(stock) {
                const stockNum = parseInt(stock) || 0;
                if (stockNum <= 0) return 'low';
                if (stockNum <= 2) return 'medium';
                return 'high';
            },
            // è·³è½¬åˆ°æ·»åŠ åŒ–å¦†å“å¾…åŠ
            redirectSaveTodo() {
                // è·³è½¬åˆ°ä¿å­˜åŒ–å¦†å“å¾…åŠ
                window.location = "/fantasy-oss/tian-jia-hua-zhuang-pin.html";
            },
            // è·³è½¬åˆ°ä¿®æ”¹åŒ–å¦†å“å¾…åŠ
            redirectUpdateTodo(todo) {
                // ä¿å­˜ID
                localStorage.setItem("oss.todo.cosmetic.id", todo.id);
                // è·³è½¬åˆ°ä¿®æ”¹åŒ–å¦†å“å¾…åŠ
                window.location = "/fantasy-oss/xiu-gai-hua-zhuang-pin.html";
            },
            // åˆå§‹åŒ–åˆ—è¡¨
            initTodoList() {
                this.loading = true;
                const param = {
                    "entity": {},
                    "pageInfo": {
                        "currPage": this.currPage,
                        "pageSize": 15
                    }
                }
                // è¯·æ±‚
                axios({
                    method: "post",
                    url: "/fantasy-oss/api/v1/oss/todo.cosmetic/list",
                    data: param
                }).then(res => {
                    // è¿½åŠ åˆ°é›†åˆä¸­
                    this.todoList = this.todoList.concat(commonUtil.getPageList(res));
                    // è·å–åˆ°æ€»é¡µæ•°
                    this.totalPage = commonUtil.getTotalPage(res);
                    this.loading = false;
                }).catch(res => {
                    this.loading = false;
                    if (res.data && res.data.msg) {
                        alert(res.data.msg)
                    } else {
                        alert("æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•")
                    }
                })
            },
            // æ»šåŠ¨åˆ°åº•éƒ¨
            onScrollToBottom() {
                this.loading = true;
                // é˜²æŠ–åŠ¨
                commonUtil.debounce(() => {
                    // æ€»é¡µæ•°å°äºç­‰äºå½“å‰é¡µ,åˆ™ä¸åŠ è½½
                    if (this.totalPage <= this.currPage) {
                        this.loading = false;
                        return;
                    }
                    // å½“å‰é¡µ+1
                    this.currPage++;
                    // åŠ è½½ä¸‹ä¸€é¡µ
                    this.initTodoList()
                }, 250);
            }
        },
        created() {
            // åˆå§‹åŒ–åˆ—è¡¨
            this.initTodoList();
        }
    });
</script>

</html>
