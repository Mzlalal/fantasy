<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞∫Â¢®ËôπËÆ∞</title>
    <!-- ÂºïÂÖ•Element UIÊ†∑Âºè -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"
    />
    <link href="css/plugin/frozen.css" rel="stylesheet" />
    <link href="css/common.css" rel="stylesheet" />
    <link href="css/plugin/vant.css" rel="stylesheet" />
    <!-- ÂºïÂÖ•VueÂíåElement UI -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="js/plugin/axios.min.js"></script>
    <script src="js/CommonUtil.js"></script>
    <script src="js/FantasyConstant.js"></script>
    <script src="js/components/PopupMenu.js"></script>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f5f5f5;
        font-family: "Arial", sans-serif;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .cup-container {
        position: relative;
        width: 240px;
        height: 480px;
        margin-bottom: 30px;
        perspective: 1000px;
      }

      .milk-tea-cup {
        position: relative;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.3s ease-out;
      }

      .cup-body {
        position: absolute;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        width: 180px;
        height: 360px;
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 10px 10px 50px 50px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1;
      }

      .cup-top {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 180px;
        height: 50px;
        background: linear-gradient(to bottom, #ffffff, #f5f5dc);
        border-radius: 50px 50px 0 0;
        z-index: 2;
        box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .cup-cream {
        position: absolute;
        top: -10px;
        left: 0;
        width: 100%;
        height: 60px;
        background: radial-gradient(circle at center, #ffffff 0%, #f5f5dc 100%);
        border-radius: 50%;
        box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.1);
      }

      .cream-topping {
        position: absolute;
        width: 8px;
        height: 8px;
        background-color: #8b4513;
        border-radius: 50%;
        z-index: 3;
      }

      .cup-lid {
        position: absolute;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 190px;
        height: 10px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 5px;
        z-index: 3;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .user-section {
        position: relative;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      .emoji {
        font-size: 40px;
        z-index: 6;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .wave-divider {
        position: absolute;
        bottom: -2px; /* Á°Æ‰øù‰∏é‰∏ãÈù¢ÁöÑÂå∫ÂüüËøûÊé• */
        left: 0;
        width: 100%;
        height: 8px; /* ËæÉÂ∞èÈ´òÂ∫¶ÁöÑÊ≥¢Êµ™ */
        background: linear-gradient(
          to bottom,
          transparent,
          rgba(255, 255, 255, 0.5),
          transparent
        );
        overflow: hidden;
        z-index: 5;
      }

      .wave {
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 60" preserveAspectRatio="none"><path d="M0,0 C100,20 200,40 300,20 C400,0 500,20 600,40 C700,20 800,0 900,20 C1000,40 1100,20 1200,0 L1200,60 L0,60 Z" fill="white" opacity="0.5"/></svg>');
        background-repeat: repeat-x;
        background-size: 50% 100%;
        animation: waveMove 5s ease-in-out infinite alternate;
      }

      @keyframes waveMove {
        0% {
          transform: translateX(-25%);
        }
        100% {
          transform: translateX(0%);
        }
      }

      .cup-reflection {
        position: absolute;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 180px;
        height: 360px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.3) 0%,
          rgba(255, 255, 255, 0) 20%,
          rgba(255, 255, 255, 0) 80%,
          rgba(255, 255, 255, 0.3) 100%
        );
        border-radius: 10px 10px 50px 50px;
        z-index: 5;
        pointer-events: none;
      }

      .cup-shadow {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 160px;
        height: 20px;
        background: rgba(0, 0, 0, 0.15);
        border-radius: 50%;
        filter: blur(8px);
        z-index: 0;
      }

      .user-legend {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 600px;
        margin-top: 20px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin: 5px 10px;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .legend-emoji {
        margin-right: 8px;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header class="ui-header ui-header-positive ui-border-b">
        <span class="username-display" @click="menuShow = true">ÊàëÁöÑËèúÂçï</span>
      </header>
      <div class="container">
        <div class="cup-container">
          <div class="milk-tea-cup" ref="milkTeaCup">
            <div class="cup-top">
              <div class="cup-cream"></div>
              <div
                v-for="i in 20"
                :key="'cream-'+i"
                class="cream-topping"
                :style="{
                                 top: Math.random() * 30 + 'px',
                                 left: Math.random() * 180 + 'px'
                             }"
              ></div>
            </div>
            <div class="cup-lid">
              <div class="straw-hole"></div>
            </div>
            <div class="cup-body">
              <div
                v-for="(user, index) in users"
                :key="user.userName"
                class="user-section"
                :style="{
                                height: user.percent + '%',
                                backgroundColor: user.color,
                                opacity: 0.9
                            }"
              >
                <div class="emoji">{{ user.emoji }}</div>
                <div v-if="index < users.length - 1" class="wave-divider">
                  <div class="wave"></div>
                </div>
              </div>
            </div>
            <div class="cup-reflection"></div>
            <div class="cup-shadow"></div>
          </div>
        </div>

        <div class="user-legend">
          <div
            v-for="user in users"
            :key="user.userName"
            class="legend-item"
            :style="{ backgroundColor: lightenColor(user.color, 30) }"
          >
            <span class="legend-emoji">{{ user.emoji }}</span>
            <span>
              {{ user.userName }} {{ user.totalWord }}Â≠ó ({{ user.percent }}%)
            </span>
          </div>
        </div>
      </div>

      <template-popup-menu :menu-show="menuShow" @on-close="menuShow = false">
        <slot>
          <button @click="redirectLatestVersion">ÂàáÊç¢Ëá≥Êñ∞ÁâàÊú¨</button>
        </slot>
        <slot>
          <button @click="redirectOlderVersion">ÂàáÊç¢Ëá≥ÊóßÁâàÊú¨</button>
        </slot>
      </template-popup-menu>
    </div>

    <script>
      new Vue({
        el: "#app",
        data() {
          return {
            // ËèúÂçïÊòæÁ§∫
            menuShow: false,
            users: [],
            emojiSets: [
              ["üòÄ", "üòÅ", "üòÇ", "ü§£", "üòÉ", "üòÑ", "üòÖ", "üòÜ"],
              ["üçé", "üçå", "üçâ", "üçá", "üçì", "üçí", "üçë", "üçç"],
              ["üê∂", "üê±", "üê≠", "üêπ", "üê∞", "ü¶ä", "üêª", "üêº"],
              ["üöó", "üöï", "üöô", "üöå", "üöé", "üèéÔ∏è", "üöì", "üöë"],
              ["‚öΩ", "üèÄ", "üèà", "‚öæ", "ü•é", "üéæ", "üèê", "üèâ"],
            ],
            colorSets: [
              ["#FFD700", "#FFA500", "#FF8C00", "#FF7F50"], // ÈªÑÈáë„ÄÅÊ©ôËâ≤Á≥ª
              ["#FF6347", "#FF4500", "#DC143C", "#B22222"], // Á∫¢Ëâ≤Á≥ª
              ["#32CD32", "#00FA9A", "#00FF7F", "#3CB371"], // ÁªøËâ≤Á≥ª
              ["#1E90FF", "#00BFFF", "#87CEEB", "#4169E1"], // ËìùËâ≤Á≥ª
              ["#9370DB", "#8A2BE2", "#9932CC", "#BA55D3"], // Á¥´Ëâ≤Á≥ª
            ],
          };
        },
        mounted() {
          this.startCupShaking();
          this.queryDiaryContentStatistics();
        },
        methods: {
          // ÁªüËÆ°Â≠óÁ¨¶
          queryDiaryContentStatistics() {
            // ËØ∑Ê±ÇÊé•Âè£
            axios({
              method: "get",
              url: "/fantasy-oss/api/v1/oss/diary/query.diary.content.statistics",
            }).then((res) => {
              this.users = res.data;
              this.regenerateEmojis();
            });
          },
          // ÂàáÊç¢Ëá≥Êñ∞ÁâàÊú¨
          redirectLatestVersion() {
            window.location = "/fantasy-oss/fei-hong-lie-biao.html";
          },
          // ÂàáÊç¢Ëá≥ÊóßÁâàÊú¨
          redirectOlderVersion() {
            window.location = "/fantasy-oss/fei-hong-lie-biao-jiu-ban-ben.html";
          },
          regenerateEmojis() {
            // ÈöèÊú∫ÈÄâÊã©‰∏ÄÁªÑemojiÂíåÂØπÂ∫îÁöÑÈ¢úËâ≤‰∏ªÈ¢ò
            const randomSetIndex = Math.floor(
              Math.random() * this.emojiSets.length
            );
            const emojiSet = this.emojiSets[randomSetIndex];
            const colorSet = this.colorSets[randomSetIndex];

            // ‰∏∫ÊØè‰∏™Áî®Êà∑ÂàÜÈÖçÈöèÊú∫emojiÂíåÈ¢úËâ≤
            this.users.forEach((user, index) => {
              const randomIndex = Math.floor(Math.random() * emojiSet.length);
              user.emoji = emojiSet[randomIndex];
              user.color = colorSet[index % colorSet.length];
            });
          },
          startCupShaking() {
            const milkTeaCup = this.$refs.milkTeaCup;

            const shake = () => {
              // ÈöèÊú∫ÈÄâÊã©ÊäñÂä®ÊñπÂêëÂíåÂπÖÂ∫¶
              const directions = ["translateX", "translateY", "rotate"];
              const direction =
                directions[Math.floor(Math.random() * directions.length)];
              const amount = Math.random() * 5 - 2.5; // -2.5Âà∞2.5‰πãÈó¥ÁöÑÈöèÊú∫ÂÄº
              const unit = direction === "rotate" ? "deg" : "px";

              // Â∫îÁî®ÊäñÂä®ÊïàÊûú
              milkTeaCup.style.transform = `${direction}(${amount}${unit})`;

              // ÊÅ¢Â§çÂéü‰ΩçÁΩÆ
              setTimeout(() => {
                milkTeaCup.style.transform = "none";
              }, 500);

              // ‰∏ã‰∏ÄÊ¨°ÊäñÂä®ÁöÑÊó∂Èó¥Èó¥ÈöîÔºà3-8ÁßíÔºâ
              const nextTime = Math.random() * 5000 + 3000;
              setTimeout(shake, nextTime);
            };

            // ÂºÄÂßãÁ¨¨‰∏ÄÊ¨°ÊäñÂä®
            const initialDelay = Math.random() * 3000;
            setTimeout(shake, initialDelay);
          },
          lightenColor(color, percent) {
            if (!color) {
              return;
            }
            // ÁÆÄÂçïÁöÑÈ¢úËâ≤Âèò‰∫ÆÂáΩÊï∞
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = ((num >> 8) & 0x00ff) + amt;
            const B = (num & 0x0000ff) + amt;

            return (
              "#" +
              (
                0x1000000 +
                (R < 255 ? R : 255) * 0x10000 +
                (G < 255 ? G : 255) * 0x100 +
                (B < 255 ? B : 255)
              )
                .toString(16)
                .slice(1)
            );
          },
        },
      });
    </script>
  </body>
</html>
