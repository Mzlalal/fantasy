<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ºå¢¨è™¹è®°</title>
    <!-- å¼•å…¥Element UIæ ·å¼ -->
    <link
      rel="stylesheet"
      href="https://static-4518.obs.cn-south-1.myhuaweicloud.com/elementui-index.css"
    />
    <link href="https://static-4518.obs.cn-south-1.myhuaweicloud.com/frozen.css" rel="stylesheet" />
    <link href="css/common.css" rel="stylesheet" />
    <link href="https://static-4518.obs.cn-south-1.myhuaweicloud.com/vant.css" rel="stylesheet" />
    <!-- å¼•å…¥Vueå’ŒElement UI -->
    <script src="https://static-4518.obs.cn-south-1.myhuaweicloud.com/vue.min.js"></script>
    <script src="https://static-4518.obs.cn-south-1.myhuaweicloud.com/elementui-index.js"></script>
    <script src="https://static-4518.obs.cn-south-1.myhuaweicloud.com/axios.min.js"></script>
    <script src="js/CommonUtil.js"></script>
    <script src="js/FantasyConstant.js"></script>
    <script src="js/components/PopupMenu.js"></script>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start; /* æ”¹ä¸ºé¡¶éƒ¨å¯¹é½ */
        min-height: 100vh;
        background-color: #f5f5f5;
        font-family: "Arial", sans-serif;
        padding-top: 10px; /* å‡å°‘é¡¶éƒ¨å¡«å…… */
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 100%;
        padding: 0 10px;
        margin-top: 100px; /* å¢åŠ é¡¶éƒ¨è¾¹è·ï¼Œä½¿å¥¶èŒ¶æ¯ä¸‹ç§» */
      }

      .cup-container {
        position: relative;
        width: 200px; /* å‡å°å®½åº¦ */
        height: 400px; /* å‡å°é«˜åº¦ */
        margin-bottom: 20px; /* å‡å°ä¸‹è¾¹è· */
        perspective: 1000px;
      }

      .milk-tea-cup {
        position: relative;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.3s ease-out;
      }

      .cup-body {
        position: absolute;
        top: 40px; /* å‡å°é¡¶éƒ¨è·ç¦» */
        left: 50%;
        transform: translateX(-50%);
        width: 150px; /* å‡å°å®½åº¦ */
        height: 300px; /* å‡å°é«˜åº¦ */
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 10px 10px 50px 50px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1;
      }

      .cup-top {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 150px; /* å‡å°å®½åº¦ */
        height: 40px; /* å‡å°é«˜åº¦ */
        background: linear-gradient(to bottom, #ffffff, #f5f5dc);
        border-radius: 50px 50px 0 0;
        z-index: 2;
        box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .cup-cream {
        position: absolute;
        top: -10px;
        left: 0;
        width: 100%;
        height: 50px; /* å‡å°é«˜åº¦ */
        background: radial-gradient(circle at center, #ffffff 0%, #f5f5dc 100%);
        border-radius: 50%;
        box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.1);
      }

      .cream-topping {
        position: absolute;
        width: 6px; /* å‡å°å¤§å° */
        height: 6px; /* å‡å°å¤§å° */
        background-color: #8b4513;
        border-radius: 50%;
        z-index: 3;
      }

      .cup-lid {
        position: absolute;
        top: 35px; /* å‡å°é¡¶éƒ¨è·ç¦» */
        left: 50%;
        transform: translateX(-50%);
        width: 160px; /* å‡å°å®½åº¦ */
        height: 8px; /* å‡å°é«˜åº¦ */
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 5px;
        z-index: 3;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .user-section {
        position: relative;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      .emoji {
        font-size: 30px; /* å‡å°å­—ä½“å¤§å° */
        z-index: 6;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .wave-divider {
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 8px;
        background: linear-gradient(
          to bottom,
          transparent,
          rgba(255, 255, 255, 0.5),
          transparent
        );
        overflow: hidden;
        z-index: 5;
      }

      .wave {
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 60" preserveAspectRatio="none"><path d="M0,0 C100,20 200,40 300,20 C400,0 500,20 600,40 C700,20 800,0 900,20 C1000,40 1100,20 1200,0 L1200,60 L0,60 Z" fill="white" opacity="0.5"/></svg>');
        background-repeat: repeat-x;
        background-size: 50% 100%;
        animation: waveMove 5s ease-in-out infinite alternate;
      }

      @keyframes waveMove {
        0% {
          transform: translateX(-25%);
        }
        100% {
          transform: translateX(0%);
        }
      }

      .cup-reflection {
        position: absolute;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 150px; /* å‡å°å®½åº¦ */
        height: 300px; /* å‡å°é«˜åº¦ */
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.3) 0%,
          rgba(255, 255, 255, 0) 20%,
          rgba(255, 255, 255, 0) 80%,
          rgba(255, 255, 255, 0.3) 100%
        );
        border-radius: 10px 10px 50px 50px;
        z-index: 5;
        pointer-events: none;
      }

      .cup-shadow {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 140px; /* å‡å°å®½åº¦ */
        height: 20px;
        background: rgba(0, 0, 0, 0.15);
        border-radius: 50%;
        filter: blur(8px);
        z-index: 0;
      }

      .user-legend {
        display: flex;
        flex-wrap: nowrap; /* æ”¹ä¸ºä¸æ¢è¡Œ */
        justify-content: center;
        overflow-x: auto; /* å…è®¸æ°´å¹³æ»šåŠ¨ */
        max-width: 100%;
        margin-top: 10px; /* å‡å°ä¸Šè¾¹è· */
        padding: 5px;
        white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin: 2px 5px; /* å‡å°å¤–è¾¹è· */
        padding: 4px 8px; /* å‡å°å†…è¾¹è· */
        border-radius: 15px;
        font-size: 12px; /* å‡å°å­—ä½“å¤§å° */
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
      }

      .legend-emoji {
        margin-right: 4px; /* å‡å°å³è¾¹è· */
        font-size: 16px; /* å‡å°å­—ä½“å¤§å° */
      }

      /* é€‚é…ç§»åŠ¨è®¾å¤‡ */
      @media (max-width: 768px) {
        .user-legend {
          justify-content: flex-start;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header class="ui-header ui-header-positive ui-border-b">
        <span class="username-display" @click="menuShow = true">æˆ‘çš„èœå•</span>
      </header>
      <div class="container">
        <div class="cup-container">
          <div class="milk-tea-cup" ref="milkTeaCup">
            <div class="cup-top">
              <div class="cup-cream"></div>
              <div
                v-for="i in 20"
                :key="'cream-'+i"
                class="cream-topping"
                :style="{
                                 top: Math.random() * 30 + 'px',
                                 left: Math.random() * 150 + 'px'
                             }"
              ></div>
            </div>
            <div class="cup-lid">
              <div class="straw-hole"></div>
            </div>
            <div class="cup-body">
              <div
                v-for="(user, index) in users"
                :key="user.userName"
                class="user-section"
                :style="{
                                height: user.percent + '%',
                                backgroundColor: user.color,
                                opacity: 0.9
                            }"
              >
                <div class="emoji">{{ user.emoji }}</div>
                <div v-if="index < users.length - 1" class="wave-divider">
                  <div class="wave"></div>
                </div>
              </div>
            </div>
            <div class="cup-reflection"></div>
            <div class="cup-shadow"></div>
          </div>
        </div>

        <div class="user-legend">
          <div
            v-for="user in users"
            :key="user.userName"
            class="legend-item"
            :style="{ backgroundColor: lightenColor(user.color, 30) }"
          >
            <span class="legend-emoji">{{ user.emoji }}</span>
            <span>
              {{ user.userName }} {{ user.totalWord }}å­— ({{ user.percent }}%)
            </span>
          </div>
        </div>
      </div>

      <template-popup-menu :menu-show="menuShow" @on-close="menuShow = false">
        <slot>
          <button @click="redirectLatestVersion">åˆ‡æ¢è‡³æ–°ç‰ˆæœ¬</button>
        </slot>
        <slot>
          <button @click="redirectOlderVersion">åˆ‡æ¢è‡³æ—§ç‰ˆæœ¬</button>
        </slot>
      </template-popup-menu>
    </div>

    <script>
      new Vue({
        el: "#app",
        data() {
          return {
            // èœå•æ˜¾ç¤º
            menuShow: false,
            users: [],
            emojiSets: [
              ["ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†"],
              ["ğŸ", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ’", "ğŸ‘", "ğŸ"],
              ["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼"],
              ["ğŸš—", "ğŸš•", "ğŸš™", "ğŸšŒ", "ğŸš", "ğŸï¸", "ğŸš“", "ğŸš‘"],
              ["âš½", "ğŸ€", "ğŸˆ", "âš¾", "ğŸ¥", "ğŸ¾", "ğŸ", "ğŸ‰"],
            ],
            colorSets: [
              ["#FFD700", "#FFA500", "#FF8C00", "#FF7F50"], // é»„é‡‘ã€æ©™è‰²ç³»
              ["#FF6347", "#FF4500", "#DC143C", "#B22222"], // çº¢è‰²ç³»
              ["#32CD32", "#00FA9A", "#00FF7F", "#3CB371"], // ç»¿è‰²ç³»
              ["#1E90FF", "#00BFFF", "#87CEEB", "#4169E1"], // è“è‰²ç³»
              ["#9370DB", "#8A2BE2", "#9932CC", "#BA55D3"], // ç´«è‰²ç³»
            ],
          };
        },
        mounted() {
          this.startCupShaking();
          this.queryDiaryContentStatistics();
        },
        methods: {
          // ç»Ÿè®¡å­—ç¬¦
          queryDiaryContentStatistics() {
            // è¯·æ±‚æ¥å£
            axios({
              method: "get",
              url: "/fantasy-oss/api/v1/oss/diary/query.diary.content.statistics",
            }).then((res) => {
              this.users = res.data;
              this.regenerateEmojis();
            });
          },
          // åˆ‡æ¢è‡³æ–°ç‰ˆæœ¬
          redirectLatestVersion() {
            window.location = "/fantasy-oss/fei-hong-lie-biao.html";
          },
          // åˆ‡æ¢è‡³æ—§ç‰ˆæœ¬
          redirectOlderVersion() {
            window.location = "/fantasy-oss/fei-hong-lie-biao-jiu-ban-ben.html";
          },
          regenerateEmojis() {
            // éšæœºé€‰æ‹©ä¸€ç»„emojiå’Œå¯¹åº”çš„é¢œè‰²ä¸»é¢˜
            const randomSetIndex = Math.floor(
              Math.random() * this.emojiSets.length
            );
            const emojiSet = this.emojiSets[randomSetIndex];
            const colorSet = this.colorSets[randomSetIndex];

            // ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…éšæœºemojiå’Œé¢œè‰²
            this.users.forEach((user, index) => {
              const randomIndex = Math.floor(Math.random() * emojiSet.length);
              user.emoji = emojiSet[randomIndex];
              user.color = colorSet[index % colorSet.length];
            });
          },
          startCupShaking() {
            const milkTeaCup = this.$refs.milkTeaCup;

            const shake = () => {
              // éšæœºé€‰æ‹©æŠ–åŠ¨æ–¹å‘ï¼Œå¢åŠ å·¦å³æ‘‡æ™ƒçš„æƒé‡
              const directions = ["rotate"];
              const direction =
                directions[Math.floor(Math.random() * directions.length)];

              // æ ¹æ®æ–¹å‘è®¾ç½®ä¸åŒçš„å¹…åº¦
              let amount;
              if (direction === "translateX") {
                // å·¦å³æ‘‡æ™ƒå¹…åº¦åŠ å¤§
                amount = Math.random() * 20 - 10; // -10åˆ°10ä¹‹é—´çš„éšæœºå€¼
              } else if (direction === "translateY") {
                // ä¸Šä¸‹æ‘‡æ™ƒå¹…åº¦ä¿æŒé€‚ä¸­
                amount = Math.random() * 8 - 4; // -4åˆ°4ä¹‹é—´çš„éšæœºå€¼
              } else {
                // æ—‹è½¬å¹…åº¦è½»å¾®å¢åŠ 
                amount = Math.random() * 12 - 6; // -6åˆ°6ä¹‹é—´çš„éšæœºå€¼
              }

              const unit = direction === "rotate" ? "deg" : "px";

              // åº”ç”¨æŠ–åŠ¨æ•ˆæœ
              milkTeaCup.style.transform = `${direction}(${amount}${unit})`;

              // æ¢å¤åŸä½ç½®
              setTimeout(() => {
                milkTeaCup.style.transform = "none";
              }, 300); // ä¿æŒè¾ƒå¿«çš„æ¢å¤æ—¶é—´

              // ä¸‹ä¸€æ¬¡æŠ–åŠ¨çš„æ—¶é—´é—´éš”ï¼ˆ1.5-4ç§’ï¼‰
              const nextTime = Math.random() * 2500 + 1500;
              setTimeout(shake, nextTime);
            };

            // å¼€å§‹ç¬¬ä¸€æ¬¡æŠ–åŠ¨
            const initialDelay = Math.random() * 1500;
            setTimeout(shake, initialDelay);
          },
          lightenColor(color, percent) {
            if (!color) {
              return;
            }
            // ç®€å•çš„é¢œè‰²å˜äº®å‡½æ•°
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = ((num >> 8) & 0x00ff) + amt;
            const B = (num & 0x0000ff) + amt;

            return (
              "#" +
              (
                0x1000000 +
                (R < 255 ? R : 255) * 0x10000 +
                (G < 255 ? G : 255) * 0x100 +
                (B < 255 ? B : 255)
              )
                .toString(16)
                .slice(1)
            );
          },
        },
      });
    </script>
  </body>
</html>
